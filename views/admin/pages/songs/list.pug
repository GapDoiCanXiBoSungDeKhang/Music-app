extends ../../layouts/default

block content
    .container-fluid.p-4
        .d-flex.justify-content-between.align-items-center.mb-4
            h2.fw-semibold.text-dark.mb-0 Quản lý bài hát
            a.btn-add(href= prefixName + '/song/create')
                i.fas.fa-plus
                |  Thêm bài hát

        .card.shadow-sm.rounded-4.border-0
            .card-body.p-4
                .search-container
                    form.search-box(action= prefixName + '/song', method='GET')
                        i.fas.fa-search
                        input(type='text', name='q', placeholder='Tìm kiếm bài hát...')
                    .filter-group
                        form#filterForm(action='/server/song', method='GET', class='filter-form')
                            select#statusSelect.filter-select.filter-status(name='status', onchange='this.form.submit()')
                                option(value='all' selected=(status === 'all')) Tất cả
                                option(value='active' selected=(status === 'active')) Active
                                option(value='inactive' selected=(status === 'inactive')) Inactive
                        form#multiActionForm(action='/server/song/change-multi?_method=PATCH', method='POST', style='display:none;')
                            input(type='hidden', name='ids', id='selectedIds')
                            input(type='hidden', name='action', id='selectedAction')
                        select.filter-select.filter-action
                            option(value='all' selected disabled) Hành động
                            option(value='delete') Xóa
                            option(value='active') Hoạt động
                            option(value='inactive') Ngưng hoạt động

                table.table.align-middle.mt-4
                    thead
                        tr
                            th.text-center
                                input#selectAll.form-check-input(type='checkbox')
                            th STT
                            th.text-center hình ảnh
                            th tiêu đề
                            th ca sĩ
                            th chủ đề
                            th.text-center nghe
                            th.text-center thích
                            th.text-center trạng thái
                            th.text-center hành động
                    tbody
                        if songs && songs.length
                            each song, index in songs
                                tr
                                    td.text-center
                                        input.form-check-input.song-checkbox(type='checkbox', value=song._id)
                                    td #{index + 1}
                                    td.text-center
                                        img.song-thumbnail(src=song.avatar || '/images/no-image.png', alt=song.title)
                                    td
                                        a.text-decoration-none.text-primary.fw-semibold(href=`/server/songs/detail/${song._id}`)= song.title
                                    td= song.singerId.fullName || '-'
                                    td= song.topicId || '-'
                                    td.text-center #{song.views ? song.views.toLocaleString() : 0}
                                    td.text-center #{song.likes ? song.likes.toLocaleString() : 0}
                                    td.text-center
                                        if song.status === 'active'
                                            span.badge.bg-success.status-toggle(
                                                data-id=song._id,
                                                data-status='active',
                                                style='cursor:pointer;'
                                            ) hoạt động
                                        else
                                            span.badge.bg-secondary.status-toggle(
                                                data-id=song._id,
                                                data-status='inactive',
                                                style='cursor:pointer;'
                                            ) ngưng hoạt động
                                    td.text-center
                                        a.btn-icon.edit(href=`/server/songs/edit/${song._id}`)
                                            i.fas.fa-pen
                                        form#singleDeleteForm(action='', method='POST', style='display:none;')
                                            input(type='hidden', name='_method', value='DELETE')
                                        a.btn-icon.delete(data-id=song._id)
                                            i.fas.fa-trash
                        else
                            tr
                                td(colspan='8' class='text-center py-4 text-muted') Không có bài hát nào.

    // Pagination + Limit control
    .d-flex.justify-content-between.align-items-center.mt-4
        // Hiển thị giới hạn số lượng
        form(action= prefixName + '/song', method='GET', class='d-flex.align-items-center')
            label.me-2.text-secondary(for='limitSelect') Hiển thị:
            select#limitSelect.form-select.form-select-sm.w-auto(
                name='limit',
                onchange='this.form.submit()'
            )
                option(value='5' selected=(limit == 5)) 5
                option(value='10' selected=(limit == 10)) 10
                option(value='20' selected=(limit == 20)) 20
                option(value='50' selected=(limit == 50)) 50
            input(type='hidden', name='q', value=q || '')
            input(type='hidden', name='status', value=status || 'all')

        // Phân trang
        if totalPages > 1
            nav
                ul.pagination.mb-0
                    if currentPage > 1
                        li.page-item
                            a.page-link(
                                href=`${prefixName}/song?page=${currentPage - 1}&limit=${limit}&q=${q || ''}&status=${status || 'all'}`) Trước
                    else
                        li.page-item.disabled
                            span.page-link Trước

                    each num in [...Array(totalPages).keys()].map(n => n + 1)
                        if num === currentPage
                            li.page-item.active
                                span.page-link= num
                        else
                            li.page-item
                                a.page-link(
                                    href=`${prefixName}/song?page=${num}&limit=${limit}&q=${q || ''}&status=${status || 'all'}`)= num

                    if currentPage < totalPages
                        li.page-item
                            a.page-link(
                                href=`${prefixName}/song?page=${currentPage + 1}&limit=${limit}&q=${q || ''}&status=${status || 'all'}`) Sau
                    else
                        li.page-item.disabled
                            span.page-link Sau

